<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register - Beautiful Mind</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(to bottom, #0f2f4a 0%, #1b5583 60%, #164b73 100%);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.container {
  background: linear-gradient(135deg, #1b5583 0%, #0f3c5f 100%);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  padding: 40px;
  max-width: 500px;
  width: 100%;
  border: 2px solid rgba(255,215,0,0.2);
  animation: slideUp 0.6s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.logo {
  text-align: center;
  margin-bottom: 30px;
}

.logo-icon {
  font-size: 3rem;
  margin-bottom: 10px;
}

h1 {
  color: #ffd700;
  font-size: 1.8rem;
  text-align: center;
  margin-bottom: 10px;
  font-weight: 800;
}

.subtitle {
  color: #e6eef4;
  text-align: center;
  font-size: 0.95rem;
  margin-bottom: 30px;
}

.form-group {
  margin-bottom: 20px;
}

label {
  display: block;
  color: #e6eef4;
  font-weight: 600;
  margin-bottom: 8px;
  font-size: 0.95rem;
}

input, select {
  width: 100%;
  padding: 12px;
  border: 2px solid rgba(255,215,0,0.2);
  border-radius: 8px;
  font-size: 0.95rem;
  background: rgba(255,255,255,0.1);
  color: #e6eef4;
  transition: all 0.3s;
}

input::placeholder {
  color: rgba(230,238,244,0.5);
}

input:focus, select:focus {
  outline: none;
  border-color: #ffd700;
  background: rgba(255,255,255,0.15);
  box-shadow: 0 0 10px rgba(255,215,0,0.2);
}

select {
  cursor: pointer;
  color: #e6eef4;
}

select option {
  background: #1b5583;
  color: white;
}

.password-hint {
  color: rgba(230,238,244,0.7);
  font-size: 0.8rem;
  margin-top: 5px;
}

.register-btn {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, #ffd700, #ffa500);
  color: #0f2f4a;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 10px;
}

.register-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(255,215,0,0.4);
}

.register-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
  opacity: 0.6;
  transform: none;
}

.login-link {
  text-align: center;
  color: #e6eef4;
  margin-top: 20px;
  font-size: 0.95rem;
}

.login-link a {
  color: #ffd700;
  text-decoration: none;
  font-weight: 700;
  cursor: pointer;
}

.login-link a:hover {
  text-decoration: underline;
}

.status-message {
  margin-top: 15px;
  padding: 12px;
  border-radius: 8px;
  display: none;
  text-align: center;
  font-weight: 600;
}

.status-message.success {
  background: rgba(60,204,60,0.3);
  color: #5c5;
  border-left: 4px solid #5c5;
  display: block;
}

.status-message.error {
  background: rgba(204,60,60,0.3);
  color: #c55;
  border-left: 4px solid #c55;
  display: block;
}

.status-message.loading {
  background: rgba(60,120,204,0.3);
  color: #5c5;
  border-left: 4px solid #5c5;
  display: block;
}

.terms {
  color: rgba(230,238,244,0.6);
  font-size: 0.8rem;
  text-align: center;
  margin-top: 15px;
  line-height: 1.5;
}

@media (max-width: 480px) {
  .container {
    padding: 25px;
  }

  h1 {
    font-size: 1.5rem;
  }
}
</style>
</head>

<body>

<div class="container">
  <div class="logo">
    <div class="logo-icon">üéì</div>
    <h1>Create Account</h1>
    <p class="subtitle">Join Beautiful Mind Learning</p>
  </div>

  <form id="registerForm">
    <!-- Email -->
    <div class="form-group">
      <label for="email">üìß Email Address *</label>
      <input 
        type="email" 
        id="email" 
        placeholder="e.g., student3@beautifulmind.com"
        required
      />
      <p style="color: rgba(230,238,244,0.6); font-size: 0.8rem; margin-top: 5px;">Must be a registered email</p>
    </div>

    <!-- Full Name -->
    <div class="form-group">
      <label for="fullName">üë§ Full Name *</label>
      <input 
        type="text" 
        id="fullName" 
        placeholder="e.g., Aarav Sharma"
        required
      />
    </div>

    <!-- Phone -->
    <div class="form-group">
      <label for="phone">üì± Phone Number *</label>
      <input 
        type="tel" 
        id="phone" 
        placeholder="e.g., 9876543210"
        pattern="[0-9]{10}"
        required
      />
    </div>

    <!-- Standard/Grade -->
    <div class="form-group">
      <label for="standard">üìö Grade/Standard *</label>
      <select id="standard" required>
        <option value="">-- Select your grade --</option>
        <option value="5th Grade">5th Grade</option>
        <option value="6th Grade">6th Grade</option>
        <option value="7th Grade">7th Grade</option>
        <option value="8th Grade">8th Grade</option>
        <option value="9th Grade">9th Grade</option>
        <option value="10th Grade">10th Grade</option>
        <option value="11th Grade">11th Grade</option>
        <option value="12th Grade">12th Grade</option>
      </select>
    </div>

    <!-- Password -->
    <div class="form-group">
      <label for="password">üîê Create Password *</label>
      <input 
        type="password" 
        id="password" 
        placeholder="Min 6 characters"
        minlength="6"
        required
      />
      <p class="password-hint">Password must be at least 6 characters</p>
    </div>

    <!-- Confirm Password -->
    <div class="form-group">
      <label for="confirmPassword">üîê Confirm Password *</label>
      <input 
        type="password" 
        id="confirmPassword" 
        placeholder="Re-enter your password"
        minlength="6"
        required
      />
    </div>

    <!-- Register Button -->
    <button type="submit" class="register-btn" id="registerBtn">
      ‚ú® Create Account
    </button>

    <!-- Status Message -->
    <div class="status-message" id="statusMessage"></div>

    <!-- Login Link -->
    <p class="login-link">
      Already have an account? <a onclick="window.location.href='/login.html'">Login here</a>
    </p>

    <p class="terms">
      By registering, you agree to our Terms of Service and Privacy Policy
    </p>
  </form>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getAuth, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
import { getDatabase, ref, set, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyAEMgcKGhZpui2eEYFA6T6SeYvWB51uRD0",
  authDomain: "beautifulmind-19645.firebaseapp.com",
  databaseURL: "https://beautifulmind-19645-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "beautifulmind-19645",
  storageBucket: "beautifulmind-19645.firebasestorage.app",
  messagingSenderId: "799227957055",
  appId: "1:799227957055:web:6a7397f3c43c7a9ed54d8a"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// ALLOWED EMAILS - ADD EMAILS HERE THAT STUDENTS CAN REGISTER WITH
const ALLOWED_EMAILS = [
  "student1@beautifulmind.com",
  "student2@beautifulmind.com",
  "student3@beautifulmind.com",
  "student4@beautifulmind.com",
  "student5@beautifulmind.com",
];

const form = document.getElementById('registerForm');
const statusMsg = document.getElementById('statusMessage');
const registerBtn = document.getElementById('registerBtn');

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const email = document.getElementById('email').value.toLowerCase();
  const fullName = document.getElementById('fullName').value;
  const phone = document.getElementById('phone').value;
  const standard = document.getElementById('standard').value;
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;

  // Check if email is allowed
  if (!ALLOWED_EMAILS.includes(email)) {
    statusMsg.className = 'status-message error';
    statusMsg.textContent = '‚ùå This email is not registered. Please ask your administrator.';
    return;
  }

  // Validate passwords match
  if (password !== confirmPassword) {
    statusMsg.className = 'status-message error';
    statusMsg.textContent = '‚ùå Passwords do not match!';
    return;
  }

  registerBtn.disabled = true;
  registerBtn.textContent = '‚è≥ Creating account...';
  statusMsg.className = 'status-message loading';
  statusMsg.textContent = '‚è≥ Creating your account...';

  try {
    // Create user in Firebase Auth
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    console.log('‚úÖ Auth user created:', user.uid);

    // Create user profile in Database
    const userRef = ref(db, `users/${user.uid}`);
    await set(userRef, {
      name: fullName,
      email: email,
      phone: phone,
      standard: standard,
      role: "student",
      stars: 0,
      lessons: 0,
      completedTopics: {},
      completedQuizzes: {},
      lastUpdated: Date.now(),
      createdAt: Date.now()
    });

    console.log('‚úÖ User profile created');

    statusMsg.className = 'status-message success';
    statusMsg.textContent = '‚úÖ Account created! Redirecting to login...';

    setTimeout(() => {
      window.location.href = '/login.html';
    }, 2000);

  } catch (error) {
    console.error('Error:', error.message);
    statusMsg.className = 'status-message error';
    
    if (error.code === 'auth/email-already-in-use') {
      statusMsg.textContent = '‚ùå This email is already registered. Please login instead.';
    } else if (error.code === 'auth/invalid-email') {
      statusMsg.textContent = '‚ùå Invalid email address.';
    } else if (error.code === 'auth/weak-password') {
      statusMsg.textContent = '‚ùå Password is too weak. Use at least 6 characters.';
    } else {
      statusMsg.textContent = '‚ùå Error: ' + error.message;
    }

    registerBtn.disabled = false;
    registerBtn.textContent = '‚ú® Create Account';
  }
});
</script>

</body>
</html>
